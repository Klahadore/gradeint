<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradient - Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Raleway:wght@500&family=Quicksand:wght@500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="../styles/sparkles.css">
</head>
<body>
    <div class="sparkles-container"></div>
    <nav class="main-nav">
        <div class="nav-logo">
            <span class="nav-logo-text">Powered by</span>
            <img src="../assets/gemini_logo.png" alt="Gemini Logo" class="nav-logo-img">
        </div>
        <div class="nav-center">
            <img src="../assets/gradient_large.png" alt="Gradient Large Logo" class="nav-logo-large">
        </div>
        <div class="nav-links">
            <a href="../index.html">Home</a>
            <a href="dashboard.html">Dashboard</a>
            <a href="grade-editor.html">Grade Editor</a>
        </div>
    </nav>
    <div class="base-panel">
        <div class="pane-title">
            <div class="title-content">
                <img src="../assets/gradient_small.png" alt="Gradient" class="title-logo">
                <span class="title-text">Preview</span>
            </div>
        </div>
        <div class="pdf-overlay">
            <iframe id="pdfViewer" src="" type="application/pdf" width="100%" height="100%"></iframe>
        </div>
    </div>
    <div class="right-panel">
        <div class="pane-title">
            <div class="title-content">
                <img src="../assets/gemini_logo_small.png" alt="Gemini" class="title-logo">
                <span class="title-text">AI Feedback</span>
            </div>
        </div>
        <div class="panel-content">
            <!-- Content will go here -->
        </div>
    </div>
    <div class="panel-buttons">
        <input type="file" id="mcqInput" accept=".pdf" style="display: none">
        <input type="file" id="frqInput" accept=".pdf" style="display: none">
        <button class="split-left" onclick="document.getElementById('mcqInput').click()">Upload MCQ Answer Key</button>
        <button class="split-right" onclick="document.getElementById('frqInput').click()">Upload FRQ Rubric</button>
        <button class="print-button" onclick="printPDFPreview()">Print</button>
    </div>
    <script>
        // Load uploaded PDF with error handling
        function loadPDF() {
            const uploadedPdfUrl = sessionStorage.getItem('uploadedPdfUrl');
            const pdfViewer = document.getElementById('pdfViewer');
            
            console.log('Attempting to load PDF...');

            if (uploadedPdfUrl && uploadedPdfUrl.startsWith('data:application/pdf')) {
                try {
                    pdfViewer.src = uploadedPdfUrl;
                    console.log('PDF loaded from session storage');
                } catch (error) {
                    console.error('Error loading PDF:', error);
                    pdfViewer.src = '../assets/mcq_42.pdf';
                }
            } else {
                console.log('No uploaded PDF found, loading default');
                pdfViewer.src = '../assets/mcq_42.pdf';
            }

            pdfViewer.onload = () => console.log('PDF iframe loaded successfully');
        }

        // Initialize PDF loading
        document.addEventListener('DOMContentLoaded', loadPDF);
        if (document.readyState === 'complete') {
            loadPDF();
        }

        function printPDFPreview() {
            const iframe = document.querySelector('.pdf-overlay iframe');
            if (iframe) {
                const pdfWindow = iframe.contentWindow;
                try {
                    pdfWindow.focus();
                    pdfWindow.print();
                } catch (e) {
                    // Fallback: open PDF in new tab if direct print fails
                    window.open(iframe.src, '_blank');
                }
            }
        }
    </script>
    <script src="../js/sparkles.js"></script>
</body>
</html>
