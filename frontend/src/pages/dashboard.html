<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gradient - Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Raleway:wght@500&family=Quicksand:wght@500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/dashboard.css">
  <link rel="stylesheet" href="../styles/sparkles.css">
</head>
<body>
  <div class="sparkles-container"></div>
  
  <nav class="main-nav">
    <div class="nav-logo">
      <span class="nav-logo-text">Powered by</span>
      <img src="../assets/gemini_logo.png" alt="Gemini Logo" class="nav-logo-img">
    </div>
    <div class="nav-center">
      <img src="../assets/gradient_large.png" alt="Gradient Large Logo" class="nav-logo-large">
    </div>
    <div class="nav-links">
      <a href="../index.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
    </div>
  </nav>

  <!-- Left panel containing the PDF preview -->
  <div class="base-panel">
    <div class="pane-title">
      <div class="title-content">
        <img src="../assets/gradient_small.png" alt="Gradient" class="title-logo">
        <span class="title-text">Preview</span>
      </div>
    </div>
    <div class="pdf-overlay">
      <div id="loadingPdf">Loading PDF...</div>
      <iframe 
        id="pdfViewer" 
        type="application/pdf"
        width="100%" 
        height="100%"
        style="display: none;"
      ></iframe>
    </div>
  </div>

  <!-- Right panel containing AI feedback or other data -->
  <div class="right-panel">
    <div class="pane-title">
      <div class="title-content">
        <img src="../assets/gemini_logo_small.png" alt="Gemini" class="title-logo">
        <span class="title-text">AI Feedback</span>
      </div>
    </div>
    <div class="panel-content">
      <!-- You can place AI feedback here or remove this altogether if not needed -->
      <p>
        Question 9: The correct answer is (A) Supporters of the Fifteenth Amendment. The student incorrectly answered (C).

        Feedback:
        
        The student needs to review the context of the 15th Amendment and its relationship to the women's suffrage movement.
        
        The 15th Amendment (1870) granted African American men the right to vote. While a significant step towards equality, it excluded women, leading to a division within the women's rights movement.
        Some women's rights advocates, like Frederick Douglass, supported the 15th Amendment, believing that it was strategically important to prioritize Black male suffrage at that time.
        Others, including Elizabeth Cady Stanton and Susan B. Anthony, strongly opposed the amendment because it did not include women. They felt betrayed by their former abolitionist allies and argued that women should have been included in the expansion of voting rights.
        The excerpt reflects the sentiment of those who opposed the 15th Amendment because it failed to address women's suffrage. Phrases like "he has withheld from her rights which are given to the most ignorant and degraded men" clearly express this frustration and sense of injustice.</p>
    </div>
  </div>

  <!-- Panel buttons, e.g. for printing -->
  <div class="panel-buttons">
    <button class="print-button" onclick="printMarkUp()">Print Mark Up</button>
    <button class="print-button" onclick="printOverlay()">Print Overlay</button>
  </div>

  <!-- Script to fetch and display the PDF, plus optional print logic -->
  <script>
    async function loadGradedPdf() {
      const pdfViewer = document.getElementById("pdfViewer");
      const loadingElement = document.getElementById("loadingPdf");
      
      try {
        const response = await fetch("http://127.0.0.1:8000/get-graded-pdf");
        if (!response.ok) throw new Error("Failed to fetch PDF");
        
        const blob = await response.blob();
        const pdfUrl = URL.createObjectURL(blob);
        
        pdfViewer.src = pdfUrl;
        pdfViewer.style.display = "block";
        loadingElement.style.display = "none";
        
      } catch (error) {
        console.error("Error loading PDF:", error);
        loadingElement.innerHTML = "Failed to load PDF. Please try again.";
      }
    }
    
    async function printMarkUp() {
      const pdfViewer = document.getElementById("pdfViewer");
      // Just trigger print on the current iframe
      pdfViewer.contentWindow.print();
    }
    
    async function printOverlay() {
      const pdfViewer = document.getElementById("pdfViewer");
      
      try {
        const response = await fetch("http://127.0.0.1:8000/get-overlay-pdf");
        if (!response.ok) throw new Error("Failed to fetch overlay PDF");
        
        const blob = await response.blob();
        const pdfUrl = URL.createObjectURL(blob);
        
        // Load and print the overlay PDF
        const overlayViewer = document.createElement('iframe');
        overlayViewer.style.display = 'none';
        overlayViewer.src = pdfUrl;
        document.body.appendChild(overlayViewer);
        
        overlayViewer.onload = function() {
          overlayViewer.contentWindow.print();
        };
      } catch (error) {
        console.error("Error printing overlay:", error);
        alert("Failed to print overlay. Please try again.");
      }
    }
    
    document.addEventListener('DOMContentLoaded', loadGradedPdf);
  </script>
  
  <script src="../js/sparkles.js"></script>
</body>
</html>